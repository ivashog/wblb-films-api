# Migration `20200904122300-initial-migration`

This migration has been generated by Olexiy Ivashkin at 9/4/2020, 3:23:00 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."actors" (
"id" SERIAL,
"full_name" text   NOT NULL ,
"films_count" integer   NOT NULL DEFAULT 1,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."films" (
"id" SERIAL,
"name" text   NOT NULL ,
"release_year" integer   NOT NULL ,
"format_id" integer   ,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."formats_dict" (
"id" SERIAL,
"name" text   NOT NULL ,
"description" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."__actors_to_films" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "actors.full_name_unique" ON "public"."actors"("full_name")

CREATE INDEX "films.name_index" ON "public"."films"("name")

CREATE UNIQUE INDEX "films.name_release_year_unique" ON "public"."films"("name", "release_year")

CREATE UNIQUE INDEX "__actors_to_films_AB_unique" ON "public"."__actors_to_films"("A", "B")

CREATE INDEX "__actors_to_films_B_index" ON "public"."__actors_to_films"("B")

ALTER TABLE "public"."films" ADD FOREIGN KEY ("format_id")REFERENCES "public"."formats_dict"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."__actors_to_films" ADD FOREIGN KEY ("A")REFERENCES "public"."actors"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."__actors_to_films" ADD FOREIGN KEY ("B")REFERENCES "public"."films"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200904122300-initial-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,42 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Actor {
+  id         Int      @id @default(autoincrement())
+  fullName   String   @unique @map("full_name")
+  filmsCount Int      @default(1) @map("films_count")
+  createdAt  DateTime @default(now()) @map("created_at")
+  updatedAt  DateTime @updatedAt @map("updated_at")
+  films      Film[]   @relation("_actors_to_films")
+
+  @@map("actors")
+}
+
+model Film {
+  id          Int         @default(autoincrement())@id
+  name        String
+  releaseYear Int         @map("release_year")
+  formatId    Int?        @map("format_id")
+  createdAt   DateTime    @default(now()) @map("created_at")
+  format      FilmFormat? @relation(fields: [formatId], references: [id])
+  actors      Actor[]     @relation("_actors_to_films")
+
+  @@index([name])
+  @@unique([name, releaseYear])
+  @@map("films")
+}
+
+model FilmFormat {
+  id          Int     @default(autoincrement()) @id
+  name        String
+  description String?
+  films       Film[]
+
+  @@map("formats_dict")
+}
```


